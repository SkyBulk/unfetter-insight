<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head profile="http://gmpg.org/xfn/11">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<link rel="stylesheet" href="http://blog.shadowserver.org/wp-content/themes/mxs2/style.css" type="text/css" media="screen" />
	<link rel="pingback" href="http://blog.shadowserver.org/xmlrpc.php" />
	<title>Cyber Espionage &#038; Strategic Web Compromises &#8211; Trusted Websites Serving Dangerous Results &laquo;  The Shadowserver Foundation</title>
	<link rel="start" href="http://blog.shadowserver.org" title="The Shadowserver Foundation Home" />
	<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="The Shadowserver Foundation &raquo; Feed" href="http://blog.shadowserver.org/feed/" />
<link rel="alternate" type="application/rss+xml" title="The Shadowserver Foundation &raquo; Comments Feed" href="http://blog.shadowserver.org/comments/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.4\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.4\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/blog.shadowserver.org\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.6"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55357,56692,8205,9792,65039],[55357,56692,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='crayon-css'  href='http://blog.shadowserver.org/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<script type='text/javascript' src='http://blog.shadowserver.org/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='http://blog.shadowserver.org/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"http:\/\/blog.shadowserver.org\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='http://blog.shadowserver.org/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta'></script>
<link rel='https://api.w.org/' href='http://blog.shadowserver.org/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://blog.shadowserver.org/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://blog.shadowserver.org/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Beware of what you download. Recent purported CEIEC document dump booby-trapped.' href='http://blog.shadowserver.org/2012/04/16/beware-of-what-you-download-recent-purported-ceiec-document-dump-booby-trapped/' />
<link rel='next' title='Reaffirmation of Values and Mission' href='http://blog.shadowserver.org/2012/05/23/reaffirmation-of-values-and-mission/' />
<link rel="canonical" href="http://blog.shadowserver.org/2012/05/15/cyber-espionage-strategic-web-compromises-trusted-websites-serving-dangerous-results/" />
<link rel='shortlink' href='http://blog.shadowserver.org/?p=24' />
<link rel="alternate" type="application/json+oembed" href="http://blog.shadowserver.org/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fblog.shadowserver.org%2F2012%2F05%2F15%2Fcyber-espionage-strategic-web-compromises-trusted-websites-serving-dangerous-results%2F" />
<link rel="alternate" type="text/xml+oembed" href="http://blog.shadowserver.org/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fblog.shadowserver.org%2F2012%2F05%2F15%2Fcyber-espionage-strategic-web-compromises-trusted-websites-serving-dangerous-results%2F&#038;format=xml" />
<style type="text/css">        #header {            background:#fff url();        }		.siteName a,.description{color:#111111}    </style></head>
<body class="post-template-default single single-post postid-24 single-format-standard">

<div id="header">
		<div class="container">
					<h1 class="siteName">
									<a class="logo_img" href="http://blog.shadowserver.org" title="The Shadowserver Foundation"><img src="http://blog.shadowserver.org/wp-content/uploads/2013/06/shadowserver_logo_with_name.png" /></a>
							</h1>
				
		</div>
		<div id="globalNavi">
			<div class="container">
					<globalNavi class="menu"><ul>
<li ><a href="http://blog.shadowserver.org/">Home</a></li><li class="page_item page-item-34"><a href="http://blog.shadowserver.org/shadowserver/">Shadowserver</a></li>
</ul></globalNavi>
	
				<form method="get" id="searchform" action="http://blog.shadowserver.org/">
<div>
    <input type="text" name="s" id="s" value="Search" onfocus="if (this.value == 'Search') {this.value = '';}" onblur="if (this.value == '') {this.value = 'Search';}" />
    <input type="submit" id="gs" value="&#8594;"/>
    </div>
</form>			</div>
		</div>		
	</div>
<div class="clear"></div>
<div id="content">
		<div class="clear"></div>



	<div id="main">		<ul id="flip1">		<li class="newer"><a href="http://blog.shadowserver.org/2012/04/16/beware-of-what-you-download-recent-purported-ceiec-document-dump-booby-trapped/" rel="prev">&laquo; Previous</a> </li>		<li class="older">|<a href="http://blog.shadowserver.org/2012/05/23/reaffirmation-of-values-and-mission/" rel="next">Next &raquo; </a> </li>		</ul>
	<div class="section entry" id="entry24" class="post-24 post type-post status-publish format-standard hentry category-cyber-espionage category-flash category-java category-malware category-targeted-intrusions">			<div class="post">			<h1 class="entry-title">Cyber Espionage &#038; Strategic Web Compromises &#8211; Trusted Websites Serving Dangerous Results</h1>				<div class="singleinfo">				<span class="dateinfo">Posted on May 15, 2012 | Category :<a href="http://blog.shadowserver.org/category/cyber-espionage/" rel="category tag">Cyber Espionage</a>, <a href="http://blog.shadowserver.org/category/flash/" rel="category tag">Flash</a>, <a href="http://blog.shadowserver.org/category/java/" rel="category tag">Java</a>, <a href="http://blog.shadowserver.org/category/malware/" rel="category tag">Malware</a>, <a href="http://blog.shadowserver.org/category/targeted-intrusions/" rel="category tag">Targeted Intrusions</a> | <span>Comments Off<span class="screen-reader-text"> on Cyber Espionage &#038; Strategic Web Compromises &#8211; Trusted Websites Serving Dangerous Results</span></span></span>				</div><div class="clear"></div>
			<div class="entry"><h5>By <a href="http://www.shadowserver.org/wiki/pmwiki.php/Profiles/StevenAdair">Steven Adair</a> and <a href="http://www.shadowserver.org/wiki/pmwiki.php/Profiles/NedMoran">Ned Moran</a><strong><br />
</strong></h5>
<p><strong></strong>In the last year, attackers engaged in cyber espionage have increasingly turned to the web to distribute their malware via drive-by exploits. The idea of distributing malware via drive-by exploits is not new at all. Internet users are constantly at risk from a daily barrage of exploits across the web as a result of mass SQL injections, malicious advertisements, stored cross site scripting (XSS), compromised web servers, etc. In most cases the miscreant’s goal is to serve malicious exploits to as many people as possible from as many locations as they can. This is where the advanced attackers engaged in cyber espionage campaigns tend to set themselves apart from the others and narrow their focus through what we call <em>strategic web compromises.</em></p>
<p>The goal is not large-scale malware distribution through mass compromises. Instead the attackers place their exploit code on websites that cater towards a particular set of visitors that they might be interested in. In the past few years we have witnessed several strategic web compromises of organizations in a variety of fields with a recurring focus on those involved with freedom of speech, human rights, defense, foreign policy and foreign relations. In these cases, normally trusted websites have been compromised to serve up malicious code designed to give backdoor access into the systems of unsuspecting visitors. In general a well patched system will be immune from many of the attacks, but in several cases previously unknown 0-day exploits (no available patch) have found their way onto these sites &#8212; in short the average visitor may not have much of a chance to defend themselves.</p>
<p>A simple one line code addition to a website, such as those seen below, can set off a chain reaction that can spell disaster for an organization.</p>
<blockquote><p>&nbsp;</p>
<div id="attachment_26" style="width: 643px" class="wp-caption alignnone"><a href="http://blog.shadowserver.org/wp-content/uploads/2012/05/aihk-iframe1.png"><img class="size-full wp-image-26  " title="aihk-iframe" src="http://blog.shadowserver.org/wp-content/uploads/2012/05/aihk-iframe1.png" alt="Amnesty Internatlion Hong Kong (CN Language Pages) iframe" width="633" height="14" srcset="http://blog.shadowserver.org/wp-content/uploads/2012/05/aihk-iframe1.png 633w, http://blog.shadowserver.org/wp-content/uploads/2012/05/aihk-iframe1-300x6.png 300w, http://blog.shadowserver.org/wp-content/uploads/2012/05/aihk-iframe1-130x2.png 130w" sizes="(max-width: 633px) 100vw, 633px" /></a><p class="wp-caption-text">Flash Exploit iFrame Link 1</p></div>
<div id="attachment_27" style="width: 733px" class="wp-caption alignnone"><a href="http://blog.shadowserver.org/wp-content/uploads/2012/05/cdi-iframe.png"><img class=" wp-image-27 " title="cdi-iframe" src="http://blog.shadowserver.org/wp-content/uploads/2012/05/cdi-iframe.png" alt="CDI iframe" width="723" height="17" srcset="http://blog.shadowserver.org/wp-content/uploads/2012/05/cdi-iframe.png 723w, http://blog.shadowserver.org/wp-content/uploads/2012/05/cdi-iframe-300x7.png 300w, http://blog.shadowserver.org/wp-content/uploads/2012/05/cdi-iframe-130x3.png 130w" sizes="(max-width: 723px) 100vw, 723px" /></a><p class="wp-caption-text">Flash Exploit iframe Link 2</p></div>
<p>&nbsp;</p></blockquote>
<h3><strong>Exploit de Jour</strong></h3>
<p><strong></strong>Right now, as you read this, there are a few recent exploits that are being heavily used by attackers engaged in cyber espionage to take a foothold onto various networks. In particular, in the past two weeks, we have seen several strategic web compromises utilize the most recent Oracle Java (CVE-2012-0507) and Adobe Flash (CVE-2012-0779) vulnerabilities. The Java vulnerabilities have been exploited to install malware on both Mac and Windows systems. Macs have been hit fairly hard in <a href="http://news.drweb.com/show/?i=2341&amp;lng=en&amp;c=14">recent months</a>, most notably with crimeware via a variant of malware dubbed FlashBack. However, advanced threat malware targeting Human Rights organizations and those in the foreign policy space have also been observed utilizing this exploit to target both OS in more limited attacks.</p>
<h4><span style="color: #ff0000;"><strong>WARNING: Live Flash and Java Exploits on the Loose</strong></span></h4>
<p>In the last few weeks there has been a notable increase in strategic web compromises used to serve the most recent Flash exploit (targeting Windows users). At the time of this writing, several high profile websites are still compromised and serving the most recent Flash exploit. If successful the exploit will drop malware from attackers typically labeled as the advanced persistent threat or “APT.”</p>
<p>We must warn against visiting the exploit sites listed in this blog as well as the compromised websites (until clean) as well. At the time of this writing (the morning of May 14, 2012) the websites for the Center for Defense Information, Amnesty International Hong Kong, and the Cambodian Ministry of Foreign Affairs ASEAN 2012 are compromised and serving one of the hostile iFrames. Visiting these websites can initiate a chain reaction in which malicious code is loaded from multiple websites and results in a system compromise for vulnerable systems without other mitigating factors.</p>
<h4><span style="text-decoration: underline; color: #008000;"><span style="text-decoration: underline;"><em>Amnesty International Hong Kong (AIHK)<br />
</em></span></span></h4>
<p>Last week Websense <a href="http://community.websense.com/blogs/securitylabs/">reported</a> that the main page of the Amnesty International United Kingdom (AIUK) website was compromised and serving Java exploits. Working with Websense we happened upon a Flash exploit site hosted on the webserver of a Library in Romanian (seen in iFrame picture above). We were able to track this exploit site back to an iFrame on the Amnesty International Hong Kong’s (AIHK) Chinese Language pages (<span style="color: #3366ff;">www.amnesty.org.hk/chi</span>). The main website no longer appears to be serving exploit code, however, the portion of the website that is in Chinese serves up this new Flash exploit code. While we do not have any direct ties between the attackers that compromised the AIUK website last week, we can see a clear connection between the attackers that have currently compromised the AIHK website and the attackers that compromised the AIUK website late last year. The AIUK compromise was detailed in a <a href="https://krebsonsecurity.com/2011/12/amnesty-international-site-serving-java-exploit/">report</a> by Brian Krebs late last year. In this most recent attack, malicious HTML is loaded by the AIHK website from <strong>www.bjc.ro</strong> (<strong>86.122.14.140</strong>). The page in turn makes a connection to <strong>71.6.131.8:80</strong> and then downloads an XOR (0x95) encoded executable from <strong>www.bjc.ro</strong>. The malicious executable drops a backdoor that phones home to <strong>glogin.ddns.us</strong>.</p>
<p>&nbsp;</p>
<h4><span style="text-decoration: underline; color: #008000;"><span style="text-decoration: underline;"><em>Center for Defense Information (CDI)<br />
</em></span></span></h4>
<p>The website of the Center for Defense Information (CDI), <span style="color: #0000ff;">www.cdi.or</span><span style="color: #0000ff;">g</span>, a DC-based NGO that researches Defense and Security policy has been compromised multiple times in the last few weeks. The CDI website is currently serving up a malicious Flash exploit that ties back attackers known to engage in cyber espionage. This threat group appears to be interested in targets with a tie to foreign policy and defense activities. Also interesting is that the website housing the malicious Flash exploit ties back to Gannet Company, Inc. and USA Today (<strong>159.54.62.92</strong>). Additional components of the exploit chain are located on systems that reside in Korea (<strong>222.239.73.36:443</strong>) and Austria (<strong>www.audioelectronic.com/213.33.76.135</strong>). Ultimately, if the exploit chain is successful, a variant of the popular Poison Ivy remote access trojan (RAT) is installed on the system. The Poison Ivy RAT phones home to <strong>windows.ddns.us </strong>(currently hosted on the Korean IP address <strong>222.122.68.8</strong>).</p>
<p><strong>Note:</strong> The main websites related to USA Today and Gannet Company, Inc do not appear to be affected.</p>
<p>The image below details the exploit chain for this particular compromise. It can be used a general guidance to understand how these exploits work in general as well.</p>
<div id="attachment_28" style="width: 1006px" class="wp-caption alignnone"><a href="http://blog.shadowserver.org/wp-content/uploads/2012/05/cdi-flash-exploit.png"><img class="size-full wp-image-28 " title="cdi-flash-exploit" src="http://blog.shadowserver.org/wp-content/uploads/2012/05/cdi-flash-exploit.png" alt="CDI Exploit Chain" width="996" height="748" srcset="http://blog.shadowserver.org/wp-content/uploads/2012/05/cdi-flash-exploit.png 996w, http://blog.shadowserver.org/wp-content/uploads/2012/05/cdi-flash-exploit-300x225.png 300w, http://blog.shadowserver.org/wp-content/uploads/2012/05/cdi-flash-exploit-130x97.png 130w" sizes="(max-width: 996px) 100vw, 996px" /></a><p class="wp-caption-text">cdi.org Exploit Chain (click to enlarge)</p></div>
<p>A prior compromise of the CDI website redirected victims, via a hidden iframe, to Java exploit (CVE-2012-0507) host at <strong>194.183.224.73</strong>. This exploit chain dropped a Poison Ivy RAT that connected to a command and control server at <strong>ids.ns01.us</strong>.</p>
<h4><span style="text-decoration: underline; color: #008000;"><span style="text-decoration: underline;"><em>Cambodian Ministry of Foreign Affairs (MFA) &#8211; ASEAN 2012</em></span></span></h4>
<p>The website for the Cambodian Ministry of Foreign Affairs (MFA), <span style="color: #0000ff;">www.asean2012.mfa.gov.kh</span>, has also been compromised to point to both Flash and Java exploits. Both the Flash and Java exploits were identical to those hosted on the CDI website.</p>
<p>(UPDATE: We&#8217;d like to extend a special thanks to our friend Kurt Baumgartner at Kaspersky Labs for providing details related to this compromised website.)</p>
<h4><span style="color: #008000;"><em><span style="text-decoration: underline;">International Institute for Counter-Terrorism (ICT)<br />
</span></em></span></h4>
<p>The websites for the International Institute of Counter-Terrorism at the Interdisciplinary Center (IDC) in Herzliya, Israel, <span style="color: #0000ff;">www.ict.org.il</span>, is also currently compromised and is housing a Java exploit (CVE-2012-0507). In this attack the website has a JavaScript file that has been modified to contain obfuscated script that points to an exploit file hosted on the website of the U.S.-based Auto Association. If the exploit is successful another Poison Ivy RAT is installed on the system. The malware from this installation calls back to <strong>javaup.updates.dns05.com</strong>. The keylogger for the RAT is not enabled by default.</p>
<h3><strong><br />
Other Recent Compromises by Same Attackers</strong></h3>
<p>In the past few weeks there have been several other websites that have been compromised by the same set of attackers responsible for the malicious code listed above. The primary exploits used in these attacks again targeted CVE-2012-0779 and CVE-2012-0507. These websites appear to have been cleaned up at the time of this writing. We would also like to note that while investigating the AIHK compromise, we found artifacts indicating that APT attackers are likely targeting the International Service for Human Rights (ISHR). We proactively scanned through three websites associated with ISHR in Germany (DE), Switzerland (CH), and the United States (US) and did not find any indication of compromise. However, we urge people from this organization and similar organizations to remain vigilant for web and e-mail based attacks.</p>
<h4><span style="color: #008000;"><em><span style="text-decoration: underline;">American Research Center in Egypt (ARCE)</span></em></span></h4>
<p>Google-cache results indicate that the American Research Center in Egypt, <span style="color: #0000ff;">www.acre.org</span>, was briefly compromised last week with an iframe pointing the the Gannett/USA Today site that had also been found on the CDI website. The compromised page&#8217;s content is still in Google&#8217;s cache and is dated May 7, 2012.</p>
<h4><em><span style="text-decoration: underline; color: #008000;">Institute for National Security Studies (INSS)<br />
</span></em></h4>
<p>Earlier this month the Israeli website for the Institute for National Security Studies (INSS), <span style="color: #0000ff;">www.inss.org.il</span>, fell victim to APT attackers and was housing JavaScript that loaded the same iFrame code that is currently on the Cambodian MFA ASEAN 2012 website. The compromise was detailed by <a href="http://community.websense.com/blogs/securitylabs/archive/2012/05/02/the-israeli-institute-for-national-security-studies-lead-to-a-posionivy-infection-flow.aspx">Websense</a> on May 2, 2012. As previously noted, this exploit would load malicious code from a Belgium webserver located at the IP address <strong>194.183.224.73</strong>.</p>
<h4><em><span style="text-decoration: underline;"><span style="color: #008000; text-decoration: underline;">The Centre for European Policy Studies (CEPS)<br />
</span></span></em></h4>
<p>Earlier this month the Centre for European Policy Studies (CEPS), <span style="color: #0000ff;">www.ceps.eu</span><em>, </em>was also compromised with the same code that pointing back to the malicious Belgium server located at <strong>194.183.224.73</strong>. This website also appears to have been cleaned since and has not been observed hosting Flash exploits.<em></em></p>
<p>&nbsp;</p>
<h3><strong>A Closer Look at the Most Recent Flash Exploit (CVE-2012-0779)</strong></h3>
<p>On May 4, 2012, <a href="https://www.adobe.com/support/security/bulletins/apsb12-09.html">Adobe Product Security Bulletin 12-09</a> (APSB12-09) was released patching a critical vulnerability in Adobe Flash. At the time of this patch release, there were already reports of this exploit being used in the wild in targeted attacks. Since this time we have observed this exploit being used in several different targeted attacks, many of which are detailed above in this post. The exploit has some interesting similarities to a previous Flash exploit that was used in targeted attackers  (CVE-2011-2110). We previously detailed this exploit in a <a href="http://www.shadowserver.org/wiki/pmwiki.php/Calendar/20110617">blog post</a> last June. We will detail the exploit by breaking down the exploit chain as seen in the CDI compromise image above in six different steps (step 0 &#8211; 5). Additional we will denote some other interesting artifacts discovered from decompiling the Flash exploit file.</p>
<h4><strong><span style="text-decoration: underline;">Step 0:</span></strong></h4>
<p style="padding-left: 30px;">The initial step in the process is for the attacker to compromise their strategically determined website. This may be done as a target of opportunity (several sites of interest but only one with a vulnerability), as a result of already having a foothold in a particular infrastructure (compromised internal infrastructure or web admin), or due to heavy scanning and targeting of a specific selected website until access is gained (vulnerability, cracked password, misconfiguration, etc.). The attackers frequently either have full control of the website or perfor SQL injection attacks to add links to their malicious code. In the case of the CDI website, we do not know how the attackers gained access to the websites. However, they were able to place the most recent iframe link at the very top of the homepage.</p>
<h4><strong><span style="text-decoration: underline;">Step 1:</span></strong></h4>
<p style="padding-left: 30px;">Unsuspecting user visits the website <span style="color: #0000ff;">www.cdi.org</span>. Along with all of the legitimate content of the website, malicious iframe pointing to http://159.54.62.92/images/image.html is sent to the user&#8217;s browser.</p>
<h4><strong><span style="text-decoration: underline;">Step 2:</span></strong></h4>
<p style="padding-left: 30px;">The user&#8217;s browser will make a request for &#8220;/images/image.html&#8221; on the 159.54.62.92 webserver. This in turn will check the user&#8217;s browser to see if they have particular versions of Windows:</p>
<div class="mceTemp" style="text-align: left; padding-left: 30px;">
<dl id="attachment_30" class="wp-caption alignnone" style="width: 955px;">
<dt class="wp-caption-dt"><a href="http://blog.shadowserver.org/wp-content/uploads/2012/05/159-vercheck.png"><img class="size-full wp-image-30" title="159-vercheck" src="http://blog.shadowserver.org/wp-content/uploads/2012/05/159-vercheck.png" alt="" width="945" height="176" srcset="http://blog.shadowserver.org/wp-content/uploads/2012/05/159-vercheck.png 945w, http://blog.shadowserver.org/wp-content/uploads/2012/05/159-vercheck-300x55.png 300w, http://blog.shadowserver.org/wp-content/uploads/2012/05/159-vercheck-130x24.png 130w" sizes="(max-width: 945px) 100vw, 945px" /></a></dt>
<dd class="wp-caption-dd">OS Version Check Script</dd>
</dl>
</div>
<p style="text-align: left; padding-left: 30px;">As seen in the snippet above, the Flash file (<strong>BrightBalls.swf</strong>) has two parameters: <em>&#8220;Elderwood</em>&#8221; and <em>&#8220;birthday</em>&#8220;. Both parameters appear to have hex values. However, these values do not simpl decode back to readily strings. The first parameter, Elderwood, is identical to what we saw with CVE-2011-2110. The value is an address that has been ZLIB compressed and then XOR encoded with 0x7A. The Elderwood value decodes to <strong>222.239.73.36:443</strong>. The second parameter, birthday, is a URL that is XOR encoded with 0xE2 and decodes to <strong><em>http://www.audioelectronic.com/download/images/f/flash.gif</em></strong>.</p>
<h4><strong><span style="text-decoration: underline;">Step 3:</span></strong></h4>
<p style="padding-left: 30px;">The unsuspecting user&#8217;s Flash decodes the aforementioned Elderwood value and initiates a Real Time Messaging Protocol (RTMP) connection to <strong>222.239.73.36</strong> on TCP port 443. The attacker must have the server listening and responding to complete the exploit chain for it to move on to the next step. The communication on port 443 is not encrypted or SSL/TLS and would stand out if looking through network traffic. The Elderwood value can decode to an IP or DNS port pair and is not restricted to any particular port.</p>
<h4><strong><span style="text-decoration: underline;">Step 4:</span></strong></h4>
<p style="padding-left: 30px;">After successfully completing the RMTP communications, the <em>birthday</em> parameter from the SWF file is decoded and the system downloads <em>/download/images/f/flash.gif</em> from www.audioelectronic.com. Needless to say, this GIF file is not actually an image. It is an EXE file that has been XOR&#8217;d with 0x95.</p>
<h4><strong><span style="text-decoration: underline;">Step 5:</span></strong></h4>
<p style="padding-left: 30px;">Once the system has XOR&#8217;d the flash.gif file, it now has a valid Poison Ivy RAT binary. The RAT is installed to the system and begins to beacon to <strong>windows.ddns.us </strong>on TCP port 443.</p>
<h4><span style="text-decoration: underline;"><strong>A Look into the SWF File</strong></span></h4>
<p>The malicious SWF file found on each exploit site referenced above (as well as a few not listed) are all the same file. The details of the file are as follows:</p>
<blockquote><p>Filename: BrightBalls.swf<br />
File Size: 8884<br />
MD5:  1EC5141051776EC9092DB92050192758<br />
SHA1: 5523b0d94d4ed3ddbb3eb6ad40640ded318c8ea7</p></blockquote>
<p>A closer look into this file reveals some interesting information. We we able to use two different basic techniques to extract the metadata from these flash files. The first technique leveraged the free tool flasm available at http://www.nowrap.de/flasm.html. Running this tool with the –d parameter  will disassemble the specified flash file. Alternatively, as a second technique, we were able to use 7zip to extract the raw flash file with the metadata still intact.</p>
<blockquote><p>$ flasm -d BrightBalls.swf &gt; BrightBalls.out</p></blockquote>
<p>The following metadata can be observed from the output:</p>
<blockquote><p>&lt;dc:title&gt;Encrypted by DoSWF&lt;/dc:title&gt;<br />
&lt;dc:description&gt;Version:5.0.3\r\nUsername:nxianguo1985@163.com.fr\r\n<br />
Index:http://www.doswf.com\r\nAuthor:http://www.laaan.cn&lt;/dc:description&gt;</p></blockquote>
<p>This metadata indicates that the flash exploit was encrypted with <strong>DoSWF</strong> – a program designed to encrypt Flash files marketed and sold by Yushi High Technology Limited in Beijing, China. There is no reason to believe that this company was involved in the creation of this exploit. However, it appears that the username of nxianguo1985@163.com.fr is the email addressed used to register the particular licensed software installation that produced the malicious flash files. This email address might therefore provide a clue to the identity of an individual involved in the creation of the exploit. However, based on other instances where various clues or artifacts have purposefully been left behind, it is very well possible that this item is a red herring.</p>
<h4><span style="text-decoration: underline;"><strong>Ties to Flash Exploits Found in Microsoft Word Documents</strong></span></h4>
<p>We have also observed CVE-2012-0779 being exploited via Microsoft Word documents. In these examples, Flash code is downloaded and executed from the web and used to carve a malicious binary out of the Word document. Inspection of the Flash files used in these attacks reveals the same metadata to those observed from the strategic web compromises. The example below is from a Microsoft  Word document was used in a targeted attack:</p>
<blockquote><p>Filename: Upcoming Key Dates.doc<br />
File size: 183906<br />
MD5:  2A93EDCD8DA17511D8ADC6D4A93DB829<br />
SHA1: 6821a3ba27dbb561e819f5d84e3f87721967539e</p></blockquote>
<p>This Word document contained JavaScript that downloaded a CVE-2012-0779 flash exploit from <strong>www.support-office-microsoft.com</strong>. The downloaded flash exploit had the following properties:</p>
<blockquote><p>File: essais.swf<br />
Size: 8005<br />
MD5:  509EE9B8E2BA13B878BFB3CBBA05283D<br />
SHA1: 786087bd6672e58a4920b4f3c642ee1a9d185e7c</p></blockquote>
<p>While the flash exploit file used in this attack had different properties then the above file used in the drive-by attacks, it had the same metadata linking it to nxianguo1985@163.com.fr and was likely developed by the same author.</p>
<h3><strong>Conclusion</strong></h3>
<p>In recent months we have continued to observe 0-day vulnerabilities emerging following discovery of their use in the wild to conduct cyber espionage attacks. Frequently by the time a patch is released for the vulnerabilities, the exploit has already been the wild for multiple weeks or months &#8212; giving the attackers a very large leg up. Individuals and organizations must keep their software patched and updated as frequently as possible. Many of these attackers are quite skilled at moving laterally within and organization and will take advantage of any entry point they have into a network. We recommend that you keep systems patched automatically if possible and are doing so for both the  Operating System (OS) and Applications. Add-ons/plug-ins for browsers and e-mail clients should also be kept up-to-date. Additionally moving to one of the most recent operatingsystems on Mac, Windows, and Linux and consider installing the 64-bit platform, if possible, is recommended. Users and organizations should consider deploying Microsoft&#8217;s <a href="http://support.microsoft.com/kb/2458544">Enhanced Mitigation Experience Toolkit (EMET)</a>.</p>
<p>Cyber Espionage attacks are not a fabricated issue and are not going away any time soon. These attackers are not spreading malware through strategically compromised websites to make friends. They are aiming to expand their access and steal data. Communications (primarily e-mail), research and development (R&amp;D), intellectual property (IP), and business intelligence (contracts, negotiations, etc) are frequently targeted and stolen. Take the cyber espionage threat seriously and not as just something you read about occasionally. The problem is vastly understated. Considered boosting your defenses in any way possible and putting extra protection mechanisms around your most valued assets. While all of the above activity can be characterized as related to advanced threats or APT, it is important to note that there is not a single monolithic group responsible for all of these attacks. Although detailing each of these groups is beyond the scope of this post, we feel that the indicators provided here should give you the information required to detect these most recent threats and provide additional considerations for mitigating these threats.</p>
</div>			<div class="clear"></div>
				
				<span class="infobottom">					 					 				</span>		</div>					<div class="related">					</div>			<div class="flip">	<div class="prevpost">&laquo; <a href="http://blog.shadowserver.org/2012/04/16/beware-of-what-you-download-recent-purported-ceiec-document-dump-booby-trapped/" rel="prev">Beware of what you download. Recent purported CEIEC document dump booby-trapped.</a></div>	<div class="nextpost"><a href="http://blog.shadowserver.org/2012/05/23/reaffirmation-of-values-and-mission/" rel="next">Reaffirmation of Values and Mission</a> &raquo;</div>	</div>
<!-- You can start editing here. -->
	<div id="comments">
		
		
					<!-- If comments are closed. -->
			<p class="nocomments">Comments are closed.</p>

				
	</div>
<div class="clear"></div>
	</div><!-- section entry -->	</div><!-- main -->	<div id="sidebar">
<ul>
		<li id="recent-posts-2" class="widget-container widget_recent_entries">		<span class="widgettitle">Recent Posts</span>		<ul>
											<li>
					<a href="http://blog.shadowserver.org/2017/12/04/avalanche-year-two-this-time-with-andromeda/">Avalanche year two, this time with Andromeda</a>
									</li>
											<li>
					<a href="http://blog.shadowserver.org/2017/11/15/and-the-song-remains-the-same/">And the Song Remains the Same</a>
									</li>
											<li>
					<a href="http://blog.shadowserver.org/2017/10/13/oops-were-doing-it-again/">Oops, We&#8217;re Doing it Again</a>
									</li>
											<li>
					<a href="http://blog.shadowserver.org/2017/04/12/kelihos-e/">Kelihos.E</a>
									</li>
											<li>
					<a href="http://blog.shadowserver.org/2016/12/01/avalanche/">Avalanche</a>
									</li>
					</ul>
		</li><li id="archives-2" class="widget-container widget_archive"><span class="widgettitle">Archives</span>		<ul>
			<li><a href='http://blog.shadowserver.org/2017/12/'>December 2017</a></li>
	<li><a href='http://blog.shadowserver.org/2017/11/'>November 2017</a></li>
	<li><a href='http://blog.shadowserver.org/2017/10/'>October 2017</a></li>
	<li><a href='http://blog.shadowserver.org/2017/04/'>April 2017</a></li>
	<li><a href='http://blog.shadowserver.org/2016/12/'>December 2016</a></li>
	<li><a href='http://blog.shadowserver.org/2016/10/'>October 2016</a></li>
	<li><a href='http://blog.shadowserver.org/2016/09/'>September 2016</a></li>
	<li><a href='http://blog.shadowserver.org/2016/06/'>June 2016</a></li>
	<li><a href='http://blog.shadowserver.org/2016/05/'>May 2016</a></li>
	<li><a href='http://blog.shadowserver.org/2015/11/'>November 2015</a></li>
	<li><a href='http://blog.shadowserver.org/2015/09/'>September 2015</a></li>
	<li><a href='http://blog.shadowserver.org/2015/08/'>August 2015</a></li>
	<li><a href='http://blog.shadowserver.org/2015/07/'>July 2015</a></li>
	<li><a href='http://blog.shadowserver.org/2015/06/'>June 2015</a></li>
	<li><a href='http://blog.shadowserver.org/2014/12/'>December 2014</a></li>
	<li><a href='http://blog.shadowserver.org/2014/08/'>August 2014</a></li>
	<li><a href='http://blog.shadowserver.org/2014/06/'>June 2014</a></li>
	<li><a href='http://blog.shadowserver.org/2014/05/'>May 2014</a></li>
	<li><a href='http://blog.shadowserver.org/2014/03/'>March 2014</a></li>
	<li><a href='http://blog.shadowserver.org/2013/07/'>July 2013</a></li>
	<li><a href='http://blog.shadowserver.org/2013/05/'>May 2013</a></li>
	<li><a href='http://blog.shadowserver.org/2013/04/'>April 2013</a></li>
	<li><a href='http://blog.shadowserver.org/2013/02/'>February 2013</a></li>
	<li><a href='http://blog.shadowserver.org/2012/08/'>August 2012</a></li>
	<li><a href='http://blog.shadowserver.org/2012/05/'>May 2012</a></li>
	<li><a href='http://blog.shadowserver.org/2012/04/'>April 2012</a></li>
	<li><a href='http://blog.shadowserver.org/2012/03/'>March 2012</a></li>
		</ul>
		</li><li id="categories-2" class="widget-container widget_categories"><span class="widgettitle">Categories</span>		<ul>
	<li class="cat-item cat-item-26"><a href="http://blog.shadowserver.org/category/anti-virus/" >Anti-Virus</a>
</li>
	<li class="cat-item cat-item-31"><a href="http://blog.shadowserver.org/category/apt/" >APT</a>
</li>
	<li class="cat-item cat-item-4"><a href="http://blog.shadowserver.org/category/botnets/" >Botnets</a>
</li>
	<li class="cat-item cat-item-63"><a href="http://blog.shadowserver.org/category/cisco/" >Cisco</a>
</li>
	<li class="cat-item cat-item-30"><a href="http://blog.shadowserver.org/category/comment-group/" >Comment Group</a>
</li>
	<li class="cat-item cat-item-19"><a href="http://blog.shadowserver.org/category/cyber-espionage/" >Cyber Espionage</a>
</li>
	<li class="cat-item cat-item-40"><a href="http://blog.shadowserver.org/category/data/" >Data</a>
</li>
	<li class="cat-item cat-item-14"><a href="http://blog.shadowserver.org/category/ddos/" >DDoS</a>
</li>
	<li class="cat-item cat-item-51"><a href="http://blog.shadowserver.org/category/exploits/" >Exploits</a>
</li>
	<li class="cat-item cat-item-17"><a href="http://blog.shadowserver.org/category/flash/" >Flash</a>
</li>
	<li class="cat-item cat-item-18"><a href="http://blog.shadowserver.org/category/java/" >Java</a>
</li>
	<li class="cat-item cat-item-3"><a href="http://blog.shadowserver.org/category/maintenance/" >Maintenance</a>
</li>
	<li class="cat-item cat-item-57"><a href="http://blog.shadowserver.org/category/shadowserver/maintenance-shadowserver/" >Maintenance</a>
</li>
	<li class="cat-item cat-item-12"><a href="http://blog.shadowserver.org/category/malware/" >Malware</a>
</li>
	<li class="cat-item cat-item-36"><a href="http://blog.shadowserver.org/category/oops/" >Oops</a>
</li>
	<li class="cat-item cat-item-39"><a href="http://blog.shadowserver.org/category/principals/" >Principals</a>
</li>
	<li class="cat-item cat-item-62"><a href="http://blog.shadowserver.org/category/scanning/" >Scanning</a>
</li>
	<li class="cat-item cat-item-13"><a href="http://blog.shadowserver.org/category/shadowserver/" >Shadowserver</a>
</li>
	<li class="cat-item cat-item-65"><a href="http://blog.shadowserver.org/category/statistics/" >Statistics</a>
</li>
	<li class="cat-item cat-item-38"><a href="http://blog.shadowserver.org/category/takedown/" >Takedown</a>
</li>
	<li class="cat-item cat-item-11"><a href="http://blog.shadowserver.org/category/targeted-intrusions/" >Targeted Intrusions</a>
</li>
	<li class="cat-item cat-item-34"><a href="http://blog.shadowserver.org/category/shadowserver/technology/" >Technology</a>
</li>
	<li class="cat-item cat-item-27"><a href="http://blog.shadowserver.org/category/visualizations/" >Visualizations</a>
</li>
	<li class="cat-item cat-item-64"><a href="http://blog.shadowserver.org/category/vpn/" >VPN</a>
</li>
	<li class="cat-item cat-item-61"><a href="http://blog.shadowserver.org/category/vulnerbilities/" >Vulnerbilities</a>
</li>
		</ul>
</li>
</ul>
</div>		</div><!-- content -->
<div id="footer">
		<p class="copyright">Copyright &copy; 2017 &middot; All Rights Reserved &middot; <a href="http://blog.shadowserver.org" title="The Shadowserver Foundation">The Shadowserver Foundation</a></p>
	<p class="support">
			Powered by <a href="http://wordpress.org/" alt="WordPress" title="WordPress">WordPress 4.9.6</a> | Theme <a href="http://axiu.me" alt="MxS2" title="designed by Axiu">MxS2</a>

	 
	</p>
</div>

<script type='text/javascript' src='http://blog.shadowserver.org/wp-includes/js/wp-embed.min.js?ver=4.9.6'></script>
</body>
</html>